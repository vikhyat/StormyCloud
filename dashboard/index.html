<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
  <head>

    <!-- Basic Page Needs
    ================================================== -->
    <meta charset="utf-8">
    <title>StormyCloud</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Mobile Specific Metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="stylesheets/base.css">
    <link rel="stylesheet" href="stylesheets/skeleton.css">
    <link rel="stylesheet" href="stylesheets/layout.css">

    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Favicons
    ================================================== -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

    <!-- jQuery -->
    <script src="/jquery.js"></script>

    <script>
      function update() {
        $.getJSON('/status', function(data) {
          var assigned = data['assigned'];
          var assigned_html = "<ol>";
          for (i=0; i<assigned.length; i++) {
            assigned_html += "<li><code>" + assigned[i] + "</code></li>";
          }
          assigned_html += "</ol>";
          $("div.assigned").html(assigned_html);

          var total = data['task_count'];
          var comp = data['completed_count'];
          var ass = data['assigned_count'];
          var eta = data['eta'];
          var res = data['result'];
          var completion_html = "";
          completion_html += "<p><strong>Total Tasks</strong>: " + total + "<br>";
          completion_html += "<strong>Assigned Tasks</strong>: " + ass + "<br>";
          completion_html += "<strong>Completed Tasks</strong>: " + comp + "</p>";
          completion_html += "<p><strong>Time Left:</strong> " + eta + "</p>"
          completion_html += "<p><strong>Result:</strong> " + res + "</p>"
          $("div.completion").html(completion_html);

          var nodes = data["nodes"];
          var times = data["node_times"];
          var nodes_html = "";
          for (n in nodes) {
            nodes_html += "<p class=node><strong>" + nodes[n] + "</strong><br />"
                          + times[nodes[n]] + "</p>";
          }
          $("div.nodes").html(nodes_html);

          $("h5.name").html("Dashboard: " + data['name']);
        });
        setTimeout("update()", 1000);
      }
      update();
    </script>

    <style>
      div.nodes {
        text-align: center;
      }
      p.node {
        background-color: #f3f3f3;
      }
    </style>

  </head>
  <body>



    <!-- Primary Page Layout
    ================================================== -->

    <div class="container">
      <div class="sixteen columns">
        <h1 class="remove-bottom" style="margin-top: 40px">StormyCloud</h1>
        <h5 class="name">Dashboard</h5>
        <hr />
      </div>
      <div class="one-third column">
        <h3>Nodes</h3>
        <hr />
        <div class="nodes"></div>
      </div>
      <div class="one-third column">
        <h3>Assigned Jobs</h3>
        <hr />
        <div class="assigned"></div>
      </div>
      <div class="one-third column">
        <h3>Completion</h3>
        <hr />
        <div class="completion"></div>
      </div>

    </div><!-- container -->


    <!-- End Document
    ================================================== -->
  </body>
</html>
